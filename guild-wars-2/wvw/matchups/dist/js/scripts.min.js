function percentage(e,t){return Math.floor(e/t*100)}function seperateThousands(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function prettyTime(e,t,a){if(t||(t=""),a||(a=""),e-60>=0)var r="minute",s=Math.floor(e/60);else var r="second",s=e;return t+s+" "+r+(s>1?"s":"")+a}function fetchNewData(){$.ajax({url:"proxy-cache.php",method:"POST",data:{resource:"gw2-wvw-matchups"},dataType:"json"}).done(function(e){lastUpdate=0,$(".matchup").each(function(t,a){var r=$(a),s=r.attr("data-matchid"),o=regions[s.toString()[0]],p=e[o][s];for(var c in p.ppt)$(".server-tick."+c.toLowerCase(),r).css("width",percentage(p.ppt[c],695)+"%"),$(".server-tick."+c.toLowerCase()+" .tick",r).text(p.ppt[c]);for(var c in p.scores)$(".server-points."+c+" .points",r).text(seperateThousands(p.scores[c])),$(".server-points."+c+" .server-points-progress",r).css("width",percentage(p.scores[c],p.highest_score)+"%");console.log(a,p)})})}function updateTime(){lastUpdate>=300&&fetchNewData(),$("#last-update-label").html(prettyTime(lastUpdate)),lastUpdate++}var regions={1:"na",2:"eu"},lastUpdate=0,worldsResponse,matchesResponse,loadedWorlds,loadedMatches,matchupTemplate,lastUpdateTimer,worlds={},objectiveScore={Camp:5,Tower:10,Keep:25,Castle:35};$(document).ready(function(){loadedWorlds=!1,loadedMatches=!1,matchupTemplate=_.template($("#tpl-matchup").html()),updateTime(),$.ajax({url:"https://api.keeky.net/proxy-cache",method:"POST",data:{resource:"gw2-wvw-matchups"},dataType:"json"}).done(function(e){lastUpdateTimer=setInterval(function(){updateTime()},1e3),$("#loader").fadeOut();for(var t in e){var a=e[t];for(var r in a){var s=a[r];$("#matches").append(matchupTemplate({matchId:r,region:s.region,serverNames:s.worlds,serverScores:s.scores,highestScore:s.highest_score,tick:s.ppt,highestTick:695}))}}})});